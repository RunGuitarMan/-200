# Minimal C Web Server

Сверхпростой высокопроизводительный веб-сервер на языке C, который отвечает `200 OK` на любой HTTP запрос. Создан для измерения максимальной пропускной способности (RPS) системы.

## Особенности

- Минимальная обработка запросов
- Предподготовленный HTTP ответ
- TCP_NODELAY для минимальной задержки
- SO_REUSEPORT для возможности запуска нескольких процессов
- Нет зависимостей (только стандартная библиотека C)

## Компиляция

### Linux

```bash
gcc -O3 -o server server.c
```

Для максимальной производительности с дополнительными оптимизациями:

```bash
gcc -O3 -march=native -o server server.c
```

### macOS

```bash
gcc -O3 -o server server.c
```

Или с использованием clang:

```bash
clang -O3 -o server server.c
```

### Windows (MinGW)

```bash
gcc -O3 -o server.exe server.c -lws2_32
```

**Примечание:** Для Windows потребуется адаптация кода для работы с Winsock2. Текущая версия оптимизирована для POSIX-систем (Linux/macOS/BSD).

### FreeBSD

```bash
cc -O3 -o server server.c
```

## Запуск

### Запуск на порту по умолчанию (8080)

```bash
./server
```

### Запуск на кастомном порту

```bash
./server 3000
```

### Запуск в фоновом режиме

```bash
./server &
```

### Запуск нескольких экземпляров для максимальной производительности

Благодаря SO_REUSEPORT можно запустить несколько процессов на одном порту:

```bash
# Запустить по одному процессу на каждое ядро CPU
for i in {1..8}; do ./server & done
```

Для автоматического определения количества ядер:

```bash
# Linux
for i in $(seq 1 $(nproc)); do ./server & done

# macOS
for i in $(seq 1 $(sysctl -n hw.ncpu)); do ./server & done
```

## Тестирование производительности

### Используя Apache Bench (ab)

```bash
ab -n 100000 -c 100 http://localhost:8080/
```

### Используя wrk

```bash
wrk -t4 -c100 -d30s http://localhost:8080/
```

### Используя hey

```bash
hey -n 100000 -c 100 http://localhost:8080/
```

## Остановка сервера

```bash
# Найти процесс
ps aux | grep server

# Остановить все процессы
pkill server

# Или просто Ctrl+C в терминале где запущен сервер
```

## Оптимизация системы для максимальной производительности

### Linux

Увеличение лимитов:

```bash
# Увеличить лимит открытых файлов
ulimit -n 65535

# Настройки sysctl для высокой нагрузки
sudo sysctl -w net.core.somaxconn=65535
sudo sysctl -w net.ipv4.tcp_max_syn_backlog=65535
sudo sysctl -w net.ipv4.ip_local_port_range="1024 65535"
sudo sysctl -w net.ipv4.tcp_tw_reuse=1
```

### macOS

```bash
# Увеличить лимит открытых файлов
ulimit -n 12288

# Увеличить backlog
sudo sysctl -w kern.ipc.somaxconn=4096
```

## Ожидаемая производительность

На современном оборудовании (8 cores, 3+ GHz):
- **Один процесс**: 50,000 - 100,000 RPS
- **Несколько процессов** (по одному на ядро): 200,000 - 500,000+ RPS

Фактическая производительность зависит от:
- Количества CPU ядер
- Скорости процессора
- Настроек сети
- Инструмента для тестирования

## Структура HTTP ответа

```
HTTP/1.1 200 OK
Content-Length: 2
Connection: close

OK
```

## Лицензия

Публичный домен. Используйте как хотите.

## Примечания

- Этот сервер создан исключительно для бенчмарков
- Не используйте в продакшене
- Нет обработки ошибок HTTP
- Нет логирования запросов
- Нет поддержки keep-alive (каждый запрос закрывает соединение)
